<style>
  /* RESET E VARI√ÅVEIS */
  * { margin: 0; padding: 0; box-sizing: border-box; }
  :root {
    --primary-blue: #1351B4;
    --primary-dark: #071D41;
    --success-green: #168821;
    --warning-yellow: #FFCD07;
    --danger-red: #E52207;
    --gray-100: #F8F9FA;
    --gray-200: #E9ECEF;
    --gray-300: #DEE2E6;
    --gray-700: #495057;
    --gray-900: #212529;
    --white: #FFFFFF;
    --shadow-sm: 0 1px 4px rgba(0,0,0,0.06);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.1);
    --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
    --radius: 12px;
    --transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
    --font-base: 'Inter', 'Rawline', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  .dashboard-container {
    max-width: 1400px;
    margin: auto;
  }

  /* HEADER */
  .page-header {
    background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
    border-radius: var(--radius);
    padding: 32px;
    margin-bottom: 32px;
    box-shadow: var(--shadow-md);
    position: relative;
    overflow: hidden;
  }
  .page-header::before {
    content:'';
    position:absolute;
    top:0; right:0;
    width:400px; height:100%;
    background: radial-gradient(circle at top right, rgba(255,255,255,0.08), transparent 70%);
    pointer-events:none;
  }
  .breadcrumb { display:flex; gap:8px; font-size:14px; color:rgba(255,255,255,0.8); margin-bottom:16px; }
  .breadcrumb a { color:rgba(255,255,255,0.9); text-decoration:none; transition: var(--transition); }
  .breadcrumb a:hover { color: var(--white); }
  .breadcrumb-separator { color: rgba(255,255,255,0.5); }

  .header-text h1 { font-size:32px; font-weight:700; color:white; margin-bottom:8px; }
  .header-text p { font-size:16px; color:rgba(255,255,255,0.85); }
  .header-actions { display:flex; gap:12px; flex-wrap:wrap; }
  .btn {
    display:inline-flex; align-items:center; gap:8px; padding:12px 24px; border:none; border-radius:var(--radius);
    font-size:14px; font-weight:600; cursor:pointer; transition: var(--transition);
  }
  .btn-primary { background:white; color:var(--primary-blue); box-shadow:var(--shadow-sm);}
  .btn-primary:hover { transform:translateY(-2px); box-shadow:var(--shadow-md); }
  .btn-secondary { background: rgba(255,255,255,0.15); color:white; backdrop-filter: blur(10px);}
  .btn-secondary:hover { background: rgba(255,255,255,0.25); }

  /* METRICS */
  .metrics-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:24px; margin-bottom:32px; }
  .metric-card {
    background:white; border-radius:var(--radius); padding:24px; border:1px solid var(--gray-200);
    box-shadow:var(--shadow-sm); transition: var(--transition); position:relative; overflow:hidden;
  }
  .metric-card::before { content:''; position:absolute; top:0; left:0; width:4px; height:100%; transition: var(--transition);}
  .metric-card.blue::before { background: var(--primary-blue); }
  .metric-card.green::before { background: var(--success-green); }
  .metric-card.yellow::before { background: var(--warning-yellow); }
  .metric-card.red::before { background: var(--danger-red); }
  .metric-card:hover { transform:translateY(-4px); box-shadow:var(--shadow-lg); border-color:transparent; }

  .metric-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
  .metric-icon { width:48px; height:48px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:24px; }
  .metric-card.blue .metric-icon { background: rgba(19,81,180,0.1); color: var(--primary-blue);}
  .metric-card.green .metric-icon { background: rgba(22,136,33,0.1); color: var(--success-green);}
  .metric-card.yellow .metric-icon { background: rgba(255,205,7,0.2); color:#B8860B;}
  .metric-card.red .metric-icon { background: rgba(229,34,7,0.1); color: var(--danger-red); }

  .metric-trend { display:flex; align-items:center; gap:4px; font-size:13px; font-weight:600; padding:4px 8px; border-radius:4px; }
  .metric-trend.up { background: rgba(22,136,33,0.1); color: var(--success-green);}
  .metric-trend.down { background: rgba(229,34,7,0.1); color: var(--danger-red);}
  .metric-trend.neutral { background: var(--gray-200); color: var(--gray-700); }

  .metric-label { font-size:14px; font-weight:500; color: var(--gray-700); margin-bottom:8px; text-transform:uppercase; letter-spacing:0.5px;}
  .metric-value { font-size:32px; font-weight:700; color: var(--gray-900); margin-bottom:4px; line-height:1.1; font-feature-settings:'tnum'; }
  .metric-description { font-size:13px; color: var(--gray-700); }

  /* CHARTS */
  .charts-section { display:grid; grid-template-columns:1fr 1fr; gap:24px; margin-bottom:32px; }
  .chart-card { background:white; border-radius:var(--radius); padding:24px; box-shadow:var(--shadow-sm); border:1px solid var(--gray-200);}
  .chart-card.full-width { grid-column:1/-1; }
  .chart-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:24px; border-bottom:2px solid var(--gray-200); padding-bottom:16px; }
  .chart-title { font-size:18px; font-weight:700; color: var(--gray-900);}
  .chart-subtitle { font-size:13px; color: var(--gray-700); margin-top:4px;}
  .chart-container { position:relative; height:300px; }

  /* ACTIVITIES */
  .activities-section { background:white; border-radius:var(--radius); padding:24px; box-shadow:var(--shadow-sm); border:1px solid var(--gray-200);}
  .section-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:24px; padding-bottom:16px; border-bottom:2px solid var(--gray-200);}
  .section-title { font-size:20px; font-weight:700; color: var(--gray-900);}
  .activities-list { display:flex; flex-direction:column; gap:16px; }
  .activity-item { display:flex; align-items:center; gap:16px; padding:16px; border-radius:var(--radius); background: var(--gray-100); transition: var(--transition);}
  .activity-item:hover { transform:translateX(4px); background: var(--gray-200);}
  .activity-icon { width:40px; height:40px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:18px; flex-shrink:0; }
  .activity-icon.pending { background: rgba(255,205,7,0.2); color:#B8860B;}
  .activity-icon.approved { background: rgba(22,136,33,0.1); color:var(--success-green);}
  .activity-icon.rejected { background: rgba(229,34,7,0.1); color:var(--danger-red);}
  .activity-content { flex:1; }
  .activity-title { font-size:15px; font-weight:600; color: var(--gray-900); margin-bottom:4px;}
  .activity-meta { display:flex; gap:12px; font-size:13px; color: var(--gray-700);}
  .activity-value { font-size:16px; font-weight:700; color: var(--gray-900);}
  .status-badge { padding:4px 12px; border-radius:12px; font-size:12px; font-weight:600; text-transform:uppercase; letter-spacing:0.5px;}
  .status-badge.pending { background: rgba(255,205,7,0.2); color:#B8860B;}
  .status-badge.approved { background: rgba(22,136,33,0.1); color: var(--success-green);}
  .status-badge.rejected { background: rgba(229,34,7,0.1); color: var(--danger-red);}

  /* RESPONSIVO */
  @media(max-width:1024px) { .charts-section { grid-template-columns:1fr; } }
  @media(max-width:768px){
    .dashboard-container { padding:16px; }
    .page-header { padding:24px; }
    .header-content { flex-direction:column; align-items:flex-start; gap:16px;}
    .header-text h1 { font-size:24px; }
    .metrics-grid { grid-template-columns:1fr; }
    .header-actions { width:100%; flex-direction:column;}
    .btn { width:100%; justify-content:center;}
  }
</style>
<div class="dashboard-container">
  <!-- HEADER -->
  <header class="page-header">
    <nav class="breadcrumb">
      <a href="/">In√≠cio</a>
      <span class="breadcrumb-separator">‚Ä∫</span>
      <span>Gest√£o Financeira</span>
    </nav>
    <div class="header-content">
      <div class="header-text">
        <h1>Gest√£o Financeira</h1>
        <p>Intermedia√ß√£o de pagamentos e transa√ß√µes</p>
      </div>
      <div class="header-actions">
        <button class="btn d-none btn-primary"><span>‚Üª</span> Atualizar</button>
        <button class="btn d-none btn-secondary"><span>‚Üì</span> Exportar</button>
      </div>
    </div>
  </header>
  <!-- METRICS -->
  <div class="metrics-grid">
    <% metrics = [
        {label: 'Volume Total', value: @orcamento_total || 0, trend: @variacao_orcamento || 0, icon: 'üí∞', desc: 'Or√ßamento total aprovado', color: 'blue', trend_class: 'up'},
        {label: 'Total Pago', value: @gastos_totais || 0, trend: @variacao_receita || 0, icon: '‚úì', desc: 'Gastos realizados', color: 'green', trend_class: 'up'},
        {label: 'Pagamentos Pendentes', value: @saldo_disponivel || 0, trend: @variacao_pendentes || 0, icon: '‚è±', desc: 'Saldo dispon√≠vel', color: 'yellow', trend_class: 'down'},
        {label: 'Receita de Taxas', value: @receita_taxas || 0, trend: @variacao_receita || 0, icon: 'üìä', desc: 'Receita de transa√ß√µes pagas', color: 'red', trend_class: 'neutral'}
      ] %>
    <% metrics.each do |m| %>
      <div class="metric-card <%= m[:color] %>">
        <div class="metric-header">
          <div class="metric-icon"><%= m[:icon] %></div>
          <div class="metric-trend <%= m[:trend_class] %>">
            <span><%= m[:trend_class] == 'up' ? '‚Üë' : m[:trend_class] == 'down' ? '‚Üì' : '‚Äî' %></span>
            <%= m[:trend] %>%
          </div>
        </div>
        <div class="metric-label"><%= m[:label] %></div>
        <div class="metric-value">R$ <%= number_with_delimiter(m[:value], delimiter: '.') %></div>
        <div class="metric-description"><%= m[:desc] %></div>
      </div>
    <% end %>
  </div>
  <!-- CHARTS -->
  <div class="charts-section">
    <div class="chart-card">
      <div class="chart-header">
        <div>
          <div class="chart-title">Solicita√ß√µes por Status</div>
          <div class="chart-subtitle">Distribui√ß√£o atual das solicita√ß√µes</div>
        </div>
      </div>
      <div class="chart-container" style="height:300px;">
        <canvas id="statusChart"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <div class="chart-header">
        <div>
          <div class="chart-title">Solicita√ß√µes por Categoria</div>
          <div class="chart-subtitle">√öltimos 30 dias</div>
        </div>
      </div>
      <div class="chart-container" style="height:300px;">
        <canvas id="categoryChart"></canvas>
      </div>
    </div>
    <div class="chart-card full-width">
      <div class="chart-header">
        <div>
          <div class="chart-title">Gastos por Centro de Custo</div>
          <div class="chart-subtitle">Distribui√ß√£o de gastos por departamento</div>
        </div>
      </div>
      <div class="chart-container" style="height:350px;">
        <canvas id="costCenterChart"></canvas>
      </div>
    </div>
  </div>
  <!-- ATIVIDADES -->
  <div class="activities-section">
    <div class="section-header">
      <h2 class="section-title">Atividades Recentes</h2>
    </div>
    <div class="activities-list">
      <% @atividades_recentes.each do |atividade| %>
        <% status = atividade[:status]&.downcase || 'pending' %>
        <div class="activity-item">
          <div class="activity-icon <%= status %>">
            <%= case status
                when 'pendente' then '‚è±'
                when 'conclu√≠da','aprovada' then '‚úì'
                else '‚úï'
                end %>
          </div>
          <div class="activity-content">
            <div class="activity-title"><%= atividade[:descricao] || atividade[:titulo] || "Atividade" %></div>
            <div class="activity-meta">
              <span>üè¢ <%= atividade[:centro_custo] || atividade[:fornecedor] || "-" %></span>
              <span>‚Ä¢</span>
              <span>üìÖ <%= atividade[:data] || "-" %></span>
            </div>
          </div>
          <div class="activity-value">R$ <%= number_with_delimiter(atividade[:valor] || 0, delimiter: '.') %></div>
          <span class="status-badge <%= status %>">
            <%= case status
                when 'pendente' then 'Pendente'
                when 'conclu√≠da','aprovada' then 'Aprovada'
                else 'Rejeitada'
                end %>
          </span>
        </div>
      <% end %>
    </div>
  </div>
</div>
<script>
  // STATUS DONUT
  const statusLabels = <%= (@status_labels || ['Em Cota√ß√£o','Conclu√≠da','Cancelada']).to_json.html_safe %>;
  const statusData = <%= (@solicitacoes_por_status || [45,35,20]).to_json.html_safe %>;

  new Chart(document.getElementById('statusChart'), {
    type: 'doughnut',
    data: {
      labels: statusLabels,
      datasets: [{
        data: statusData,
        backgroundColor: ['#168821','#FFCD07','#E52207'],
        borderWidth: 0,
        hoverOffset: 8
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '65%',
      plugins: {
        legend: { position: 'bottom', labels: { color:'#212529' } },
        tooltip: {
          callbacks: {
            label: ctx => `${ctx.label}: ${Number(ctx.parsed).toLocaleString('pt-BR')}`
          }
        }
      }
    }
  });

  // CATEGORIA BAR
  const categoriaLabels = <%= (@solicitacoes_por_categoria.map { |c| c.is_a?(Hash) ? (c[:descricao]||c[:label]) : "Categoria #{c}" }).to_json.html_safe %>;
  const categoriaData = <%= (@solicitacoes_por_categoria.map { |c| c.is_a?(Hash) ? (c[:count]||c[:value]) : c }).to_json.html_safe %>;

  new Chart(document.getElementById('categoryChart'), {
    type: 'bar',
    data: {
      labels: categoriaLabels,
      datasets: [{ data: categoriaData.map(Number), backgroundColor:'#1351B4', borderRadius:8 }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend:{ display:false } },
      scales: {
        y: { beginAtZero:true, ticks:{ color:'#212529', stepSize:1 }, grid:{ color:'#E9ECEF', drawBorder:false } },
        x: { ticks:{ color:'#212529' }, grid:{ display:false } }
      }
    }
  });

  const centroLabels = <%= (@gastos_por_centro.map { |c| c.is_a?(Hash) ? (c[:nome]||c[:label]) : "Centro #{c}" }).to_json.html_safe %>;
  const centroData = <%= (@gastos_por_centro.map { |c| c.is_a?(Hash) ? (c[:valor]||c[:amount]) : c }).to_json.html_safe %>;

  new Chart(document.getElementById('costCenterChart'), {
    type:'bar',
    indexAxis:'y',
    data: {
      labels: centroLabels,
      datasets: [{
        data: centroData.map(Number),
        backgroundColor:['#1351B4','#168821','#FFCD07','#E52207','#495057'],
        borderRadius:6
      }]
    },
    options: {
      responsive:true,
      maintainAspectRatio:false,
      plugins:{
        legend:{ display:false },
        tooltip:{
          callbacks:{
            label: ctx => 'R$ ' + Number(ctx.parsed.x).toLocaleString('pt-BR')
          }
        }
      },
      scales:{
        x:{
          beginAtZero:true,
          ticks:{
            color:'#212529',
            callback: v => 'R$ ' + Number(v/1000).toLocaleString('pt-BR') + 'k'
          },
          grid:{ color:'#E9ECEF', drawBorder:false }
        },
        y:{
          ticks:{ color:'#212529', font:{ weight:'600' } },
          grid:{ display:false }
        }
      }
    }
  });
</script>
