<%= render "shared/context_nav", title: "Preencher Itens da Proposta" do %>
  <span class="breadcrumb-item">
    <%= link_to "Propostas", o_propostas_path, class: "text-dark" %>
  </span>
  <span class="breadcrumb-item active">Itens</span>
<% end %>
<%= simple_form_for @o_proposta, url: o_propostas_itens_path(o_proposta_id: @o_proposta.id), method: :post do |f| %>
  <div class="card">
    <div class="card-header">
      <h5 class="my-0">
        Preenchimento de Itens — <%= @o_proposta.o_cotacao.o_solicitacao.descricao if @o_proposta.o_cotacao&.o_solicitacao %>
      </h5>
    </div>
    <div class="card-body">
      <%= f.error_notification %>
      <% @o_proposta.o_proposta_itens.each do |item| %>
        <%= f.simple_fields_for :o_proposta_itens, item do |item_form| %>
          <div class="border rounded p-3 mb-3">
            <div class="row mb-2">
              <div class="col-6">
                <strong>Descrição:</strong>
                <%= item.o_cotacao_item&.descricao || "Não definido" %>
              </div>
              <div class="col-3">
                <strong>Quantidade:</strong>
                <%= item.o_cotacao_item&.quantidade || 0 %>
              </div>
              <div class="col-3">
                <strong>Tipo:</strong>
                <%= item.o_cotacao_item&.o_categoria_servico&.descricao || "Não definido" %>
              </div>
            </div>
            <div class="row mb-2">
              <div class="col-4">
                <%= item_form.input :valor_unitario, label: "Valor Unitário",
                      input_html: { class: "form-control money", placeholder: "0,00" } %>
              </div>
              <div class="col-8">
                <%= item_form.input :observacao, label: "Observações",
                      input_html: { class: "form-control", placeholder: "Informações adicionais (opcional)" } %>
              </div>
            </div>
            <div class="row mb-2">
              <div class="col-12">
                <strong>Total:</strong>
                <%= number_to_currency(item.total_item || 0) %>
              </div>
            </div>
            <%= item_form.hidden_field :id, value: item.id %>
            <%= item_form.hidden_field :o_proposta_id, value: @o_proposta.id %>
          </div>
        <% end %>
      <% end %>
    </div>
    <div class="card-footer d-flex justify-content-between">
      <%= f.submit "Enviar Proposta", class: "btn btn-primary" %>
      <%= link_to "Voltar", o_propostas_path, class: "btn btn-light" %>
    </div>
  </div>
<% end %>
