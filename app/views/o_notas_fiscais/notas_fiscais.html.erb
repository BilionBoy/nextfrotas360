<div class="card">
  <div class="card-header">
    <h3>Relatório de Notas Fiscais Enviadas</h3>
  </div>
  <div class="card-body">
    <!-- Filtros -->
    <%= form_with url: relatorio_o_notas_fiscais_path, method: :get, local: true, class: "row g-3 mb-4" do |f| %>
      <div class="col-md-3">
        <%= f.label :os_numero, "Número da OS" %>
        <%= f.text_field :os_numero, value: params[:os_numero], class: "form-control" %>
      </div>
      <div class="col-md-3">
        <%= f.label :status_nf, "Status da NF" %>
        <%= f.select :status_nf, options_from_collection_for_select(OStatusNf.all, :id, :descricao, params[:status_nf]), { include_blank: "Todos" }, class: "form-select" %>
      </div>
      <div class="col-md-3">
        <%= f.label :data_inicio, "Data Início" %>
        <%= f.date_field :data_inicio, value: params[:data_inicio], class: "form-control" %>
      </div>
      <div class="col-md-3">
        <%= f.label :data_fim, "Data Fim" %>
        <%= f.date_field :data_fim, value: params[:data_fim], class: "form-control" %>
      </div>
      <div class="col-12 mt-2">
        <%= f.submit "Filtrar", class: "btn btn-primary" %>
      </div>
    <% end %>
    <!-- Tabela -->
    <table class="table table-striped table-bordered mt-3">
      <thead>
        <tr>
          <th>OS Número</th>
          <th>NF Número</th>
          <th>Data Emissão</th>
          <th>Valor Total (R$)</th>
          <th>Status NF</th>
          <th>PDF</th>
          <th>XML</th>
        </tr>
      </thead>
      <tbody>
        <% @notas_fiscais.each do |nf| %>
          <tr>
            <td><%= nf.o_ordem_servico.numero %></td>
            <td><%= nf.numero %></td>
            <td><%= nf.data_emissao.strftime("%d/%m/%Y") %></td>
            <td><%= number_to_currency(nf.valor_total, unit: "R$") %></td>
            <td><%= nf.o_status_nf.descricao %></td>
            <td>
              <% if nf.arquivo_pdf.attached? %>
                <%= link_to "PDF", rails_blob_path(nf.arquivo_pdf, disposition: "attachment"), class: "btn btn-sm btn-outline-primary" %>
              <% end %>
            </td>
            <td>
              <% if nf.arquivo_xml.attached? %>
                <%= link_to "XML", rails_blob_path(nf.arquivo_xml, disposition: "attachment"), class: "btn btn-sm btn-outline-primary" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
